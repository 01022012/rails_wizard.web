# >---------------------------[ Install Command ]-----------------------------<
#  <%= "rails new APP_NAME -m #{compile_url(template)} #{template.command_line_options}" %>
# >---------------------------------------------------------------------------<
#
#            _____       _ _   __          ___                  _ 
#           |  __ \     (_) |  \ \        / (_)                | |
#           | |__) |__ _ _| |___\ \  /\  / / _ ______ _ _ __ __| |
#           |  _  // _` | | / __|\ \/  \/ / | |_  / _` | '__/ _` |
#           | | \ \ (_| | | \__ \ \  /\  /  | |/ / (_| | | | (_| |
#           |_|  \_\__,_|_|_|___/  \/  \/   |_/___\__,_|_|  \__,_|
#
#   This template was generated by RailsWizard, the amazing and awesome Rails
#     application template builder. Get started at http://railswizard.org
#
#  ___________________________________________________________________________
# |/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/|
# |             |                                                             |
# | Name:       | <%= template.name.ljust(59) %> |
# | URL:        | <%= compile_url(template).ljust(59) %> |
# | Updated:    | <%= template.updated_at.strftime("%B %d, %Y at %H:%M%p").ljust(59) %> |
# |             |                                                             |
# |\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\/\|
#  ---------------------------------------------------------------------------

# >----------------------------[ Initial Setup ]------------------------------<

initializer 'generators.rb', <<-RUBY
Rails.application.config.generators do |g|
end
RUBY

template = <%=raw RailsTemplate::RECIPE_FIELDS.inject({}){|h,f| h[f] = template.send(f); h}.inspect %>
recipes = template.values.flatten

def say_recipe(name); say "\033[36m" + "recipe".rjust(10) + "\033[0m" + "    Running #{name} recipe..." end
def say_wizard(text); say "\033[36m" + "wizard".rjust(10) + "\033[0m" + "    #{text}" end

@after_blocks = []
def after_bundler(&block); @after_blocks << block; end

<% RailsTemplate::RECIPE_FIELDS.each do |f| %>
<% if r = Recipe.find_by_slug(template.send(f)) %>
<%=raw r.compile rescue '' %>
<% end %>
<% end %>

<% if template.custom_code? %># >-----------------------------[ Custom Code ]-------------------------------<

<%= raw template.custom_code %><% end %>

# >-----------------------------[ Run Bundler ]-------------------------------<

say_wizard "Running Bundler install. This will take a while."
run 'bundle install'
say_wizard "Running after Bundler callbacks."
@after_blocks.each{|b| b.call}