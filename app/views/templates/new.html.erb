<%= form_for template, :url => templates_path do |f| %>
  <header>
    <h1>Your Recipe</h1>
    <button type='submit'>Create Template &raquo;</button>
  </header>

  <ul class='recipes' id='selected_recipes'>
  </ul>
<% end %>

<section id='recipe_picker'>
<nav id='recipe_filters'>
    <input type='text' id='name_filter' placeholder='Filter by name...'/>

    <%= link_to "all", "#", "data-filter" => "*" %>
    <% RailsWizard::Recipes.categories.each do |category| %>
      <%= link_to category.gsub('_',' '), "#", :class => category, "data-filter" => "[data-category=#{category}]" %>
    <% end %>
  </nav>

  <ul class='recipes' id='unused_recipes'>
  <% for recipe in RailsWizard::Recipes.list_classes %>
    <li class='<%= recipe.category %>' data-name="<%= recipe.name.downcase %>" data-category='<%= recipe.category %>'>
      <%= hidden_field_tag "template[recipes][]", recipe.key %>
      <b><%= recipe.name %></b>
      <span><%= recipe.description %></span>
    </li>
  <% end %>
  </ul>
</section>

<script type='text/javascript'>
$(function() {
  $('ul.recipes').isotope({
    itemSelector:'li',
    layoutMode:'fitRows',
    animationEngine:'best-available'
  });

  $('#recipe_filters a').click(function() {
    $('#unused_recipes').isotope({
      filter:$(this).attr('data-filter')
    }); 
    return false;
  });

  $('#unused_recipes').delegate('li:not(.disabled)','click',function() {
    $('#unused_recipes').isotope('remove',$(this)).isotope('reLayout').isotope({filter:'*'});
    $('#selected_recipes').isotope('insert', $(this).clone());
    $('#unused_recipes').find('li[data-category=' + $(this).attr('data-category') + ']').addClass('disabled');
    $('#name_filter').val('');
    return false;
  });

  $('#selected_recipes').delegate('li:not(.disabled)','click',function() {
    $('#selected_recipes').isotope('remove',$(this)).isotope('reLayout');
    $('#unused_recipes').isotope('insert', $(this).clone());
    $('#unused_recipes').find('li[data-category=' + $(this).attr('data-category') + ']').removeClass('disabled');
    return false;
  });

  setInterval(function() {
    $('#recipe_picker').css('margin-top', $('#new_rails_template').height() + 20);
  });  

  $('#name_filter').keydown(function() {
    if ($(this).val() == '')
      var filter = "*"
    else
      var filter = "[data-name^=" + $(this).val() + "]"
    
    $('#unused_recipes').isotope({filter:filter}); 
  });

  var letters = "abcdefghijklmnopqrstuvwxyz".split('');
  $(document).keydown(function(e) {
    var input = $('#name_filter')    
    if (e.keyCode >= 65 && e.keyCode <= 90) {
      input.val(input.val() + letters[e.which - 65]);
      input.trigger('keydown');
    } 
    else if (e.keyCode === 8) {
      input.val(input.val().substring(0, input.val().length - 1));
      input.trigger('keydown')
      return false;
    }
  });
});
</script>
